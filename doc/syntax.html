<h1 operator="">Syntax</h1><p>Living in a structural world is nice, but sometimes we need to convert structural content to/from plain text representation, e.g. for file I/O and system clipboard. Neomacs provides some low-level hooks and a table-driven parser framework for converting to/from plain text.</p><h2>(De)-serialization functions</h2><p>Interface to parsers:</p><dl><dt operator="" class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">vardoc</span><span class="symbol">'*dom-output*</span></div></dt><dt class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">'read-dom</span></div></dt><dt class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">'read-from-file</span></div></dt></dl><p>The following hooks implement actual (de)-serialization:</p><dl><dt operator="" class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">'read-dom-aux</span></div></dt><dt class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">'write-dom-aux</span></div></dt></dl><p>Note that parsers <code>use append-child</code> to append children to <code>*dom-output*</code> directly, i.e. they use <a href="dom.html#low-level-dom-edits">low-level DOM edits</a> instead of <a href="edit.html#editing-primitives">editing-primitives</a>. It is therefore important to never bind <code>*dom-output*</code> to live DOM nodes in any buffer, which would result in corrupted state (<a href="dom.html#notes-on-dom-consistency">inconsistency</a> between Lisp-side and renderer-side DOM). Typically, one wants to call the parser to build DOM nodes outside any buffer, then use <code>insert-nodes</code> to insert them into some buffer if needed.</p><h2>Table-driver parser</h2><p>Neomacs provides a parser framework driven by <i>syntax-tables</i>, which bind characters to functions that consume some (more) characters and builds DOM nodes. The parser reads a character from input stream, looks it up in <code>*syntax-table*</code>, and calls the function with two arguments: the stream and the character. If the character is not bound to any function, the special value <code>t</code> is looked up in <code>*syntax-table*</code> next, and the function (if any) bound to <code>t</code> is used as default. If <code>t</code> does not have binding either, an error is signaled.</p><dl><dt operator="" class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">'get-syntax-table</span></div></dt><dt class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">'set-syntax-range</span></div></dt><dt class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">'make-syntax-table</span></div></dt><dt class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">vardoc</span><span class="symbol">'*syntax-table*</span></div></dt></dl><p>It's quite common to read consecutive characters of the same &quot;category&quot; as a string and process as a whole, possibly building a DOM element or inserting as text. The following functions help with such cases:</p><dl><dt operator="" class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">'read-constituent</span></div></dt><dt class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">'append-text</span></div></dt></dl><dl><dt operator="">Some functions suitable for binding to in syntax tables:</dt></dl><dl><dt operator="" class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">'read-newline</span></div></dt><dt class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">'read-text</span></div></dt><dt class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">'read-ignore</span></div></dt></dl>