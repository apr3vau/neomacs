<!DOCTYPE html>
<html><head></head><body><h1 operator="" id="editing">Editing</h1><h2 id="editing-primitives">Editing primitives</h2><p>Lisp programs are expected to use the following primitives to edit the Neomacs DOM. These primitives provides <a href="positions.html">positions</a>-based interface and handles text-node splitting and merging automatically. These primitives also maintain <a href="undo.html">undo</a> history, update renderer-side DOM,  manage setup and destruction of observers and computed attributes, and allocate <code>neomacs-identifier</code>&#39;s.</p><dl><dt class="comma-expr" operator=""><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;delete-nodes</span></div></dt><dt class="comma-expr" operator=""><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;extract-nodes</span></div></dt><dt class="comma-expr" operator=""><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;insert-nodes</span></div></dt><dt class="comma-expr" operator=""><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;move-nodes</span></div></dt></dl><h2 id="editing-hooks">Editing hooks</h2><p>More often than not the structured data in a buffer only makes sense if they follow certain constraints or invariants. Neomacs provides a number of facilities to help enforcing invariants, including <a href="dom.html#attributes">computed attributes</a>, <a href="command-loop.html#buffer-transactions">pre/post command hooks</a> and the following facilities.</p><p>Catch all nodes entering and leaving a buffer&#39;s DOM:</p><dl><dt operator="" class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;on-node-setup</span></div></dt><dt class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;on-node-cleanup</span></div></dt></dl><p>Schedule some action to run after current command invocation if a node is edited:</p><dl><dt operator="" class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;with-post-command</span></div></dt></dl><p>Typically, <code>on-node-setup</code> is used to register some computed attributes and post command actions depending on type of node being inserted. <code>with-post-command</code> should be used to restore invariants instead of adding observers (via <code>lwcells</code>&#39;s <code>add-observer</code>) that directly edits the DOM, because observers can run in the middle of compound editing operations and commands which might cause unpredictable behavior.</p><h2 id="compound-editing-operations">Compound editing operations</h2><p>Functions implemented using <a href="#editing-primitives">editing primitives</a>, provided for convenience:</p><dl><dt class="comma-expr" operator=""><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;splice-node</span></div></dt><dt class="comma-expr" operator=""><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;join-nodes</span></div></dt><dt class="comma-expr" operator=""><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;raise-node</span></div></dt><dt class="comma-expr" operator=""><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;split-node</span></div></dt><dt class="comma-expr" operator=""><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;wrap-node</span></div></dt><dt class="comma-expr" operator=""><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;delete-node</span></div></dt><dt class="comma-expr" operator=""><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;replace-node</span></div></dt></dl><h2 id="editing-commands">Editing commands</h2><p>The following generic editing commands are avaliable in any Neomacs buffer:</p><dl><dt class="comma-expr" operator=""><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;new-line</span></div></dt><dt class="comma-expr" operator=""><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;backward-delete</span></div></dt><dt class="comma-expr" operator=""><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;forward-delete</span></div></dt><dt class="comma-expr" operator=""><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;backward-delete-word</span></div></dt><dt class="comma-expr" operator=""><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;self-insert-command</span></div></dt></dl><h2 id="the-clipboard">The clipboard</h2><dl><dt operator="" class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">vardoc</span><span class="symbol">&#39;*clipboard-ring*</span></div></dt><dt class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">vardoc</span><span class="symbol">&#39;*clipboard-ring-index*</span></div></dt></dl><h2 id="clipboard-commands">Clipboard commands</h2><dl><dt operator="" class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;cut-element</span></div></dt><dt class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;copy-element</span></div></dt><dt class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;paste</span></div></dt><dt class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;paste-pop</span></div></dt><dt class=" comma-expr"><div class="list" operator=""><span class="symbol" operator="">fundoc</span><span class="symbol">&#39;forward-cut</span></div></dt></dl></body></html>